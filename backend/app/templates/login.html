<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | CryptoVol.ai</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399', 500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b' },
                        dark: { 900: '#0a0a0a', 800: '#1a1a1a', 700: '#2a2a2a', 600: '#3a3a3a', 500: '#4a4a4a' }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Space Grotesk', sans-serif; background-color: #0a0a0a; color: white; overflow-x: hidden; }
        .gradient-text { background: linear-gradient(90deg, #34d399, #10b981); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .card-glass { background: rgba(26, 26, 26, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 16px; }
        .btn-primary { background: linear-gradient(90deg, #10b981, #059669); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }
        .form-input { background: rgba(26, 26, 26, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px 16px; color: white; transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2); }
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="vanta-bg" class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav class="py-6 px-4 sm:px-8 lg:px-16 xl:px-32 flex justify-between items-center">
            <div class="flex items-center">
                <a href="/" class="flex items-center">
                    <i data-feather="activity" class="text-primary-500 mr-2"></i>
                    <span class="text-2xl font-bold gradient-text">CryptoVol.ai</span>
                </a>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-gray-400 hidden sm:inline">Don't have an account?</span>
                <a href="/signup" class="px-4 py-2 rounded-lg bg-dark-700 hover:bg-dark-600 text-white transition">Sign Up</a>
            </div>
        </nav>

        <!-- Login Form -->
        <div class="flex-grow flex items-center justify-center px-4 sm:px-8 py-8">
            <div class="w-full max-w-md">
                <div class="card-glass p-8">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold mb-2">Welcome <span class="gradient-text">Back</span></h1>
                        <p class="text-gray-400">Sign in to access your dashboard</p>
                    </div>

                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                            <input type="email" id="email" name="username" class="form-input w-full" placeholder="john@example.com" required>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
                                <a href="#" class="text-xs text-primary-500 hover:text-primary-400">Forgot password?</a>
                            </div>
                            <input type="password" id="password" name="password" class="form-input w-full" placeholder="••••••••" required>
                        </div>

                        <button type="submit" id="submitBtn" class="w-full py-3 px-4 rounded-lg btn-primary text-white font-semibold flex justify-center items-center gap-2">
                            <span>Sign In</span>
                            <div class="spinner" id="btnLoader"></div>
                        </button>

                        <div id="errorMessage" class="hidden text-red-500 text-sm text-center mt-2 bg-red-900/20 p-2 rounded border border-red-500/20"></div>
                    </form>

                    <div class="mt-6 text-center">
                        <p class="text-gray-400">New to CryptoVol.ai? <a href="/signup" class="text-primary-500 hover:text-primary-400 font-medium">Create account</a></p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="py-8 px-4 text-center">
            <p class="text-gray-500 text-sm">© 2025 CryptoVol.ai. All rights reserved.</p>
        </footer>
    </div>

    <script>
        VANTA.GLOBE({
            el: "#vanta-bg",
            mouseControls: true, touchControls: true, gyroControls: false,
            minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
            color: 0x10b981, backgroundColor: 0x0a0a0a, size: 0.8
        });
        feather.replace();

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const submitBtn = document.getElementById('submitBtn');
            const btnLoader = document.getElementById('btnLoader');
            const errorDiv = document.getElementById('errorMessage');

            // Сброс UI
            errorDiv.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-75');
            btnLoader.style.display = 'block';

            // Формируем FormData (т.к. бэкенд использует Form(...))
            const formData = new FormData();
            formData.append('email', email);
            formData.append('password', password);

            try {
                // Используем правильный путь к API логина
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    body: formData // Отправляем не JSON, а FormData
                });

                const data = await response.json();

                if (response.ok) {
                    // Сохраняем токен (если он есть)
                    if(data.token) {
                        localStorage.setItem('access_token', data.token);
                    }
                    // Редирект (например на главную, пока дашборда нет)
                    window.location.href = '/';
                } else {
                    errorDiv.textContent = data.detail || 'Login failed. Please check your credentials.';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error(error);
                errorDiv.textContent = 'Network error. Try again later.';
                errorDiv.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-75');
                btnLoader.style.display = 'none';
            }
        });
    </script>
</body>
</html>
